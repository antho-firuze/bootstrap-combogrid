!function(a){"use strict";function b(b,c){function t(){if("bs3"==d.style)return'<div class="combogrid-container"><div class="input-group"><input type="hidden" /><div class="input-group-btn"><span class="btn btn-default dropdown-toggle" data-dropdown="dropdown"><span class="caret" /></span></div></div></div>'}function u(){return'<ul class="typeahead-long dropdown-menu dropdown-menu-right"></ul>'}function v(){var b=a.extend({},e.position(),{height:e[0].offsetHeight});i.insertAfter(e).css({top:b.top+b.height,left:b.left}).show(),k=!0}function w(){i.hide(),a(".dropdown-menu").off("mousedown",function(a){"UL"==a.target.tagName}),k=!1}function x(){l=!1;var a=e.val(),b=e.attr("value"),c=e.val();(!m&&""==a||m&&""==a)&&(e.attr("value","").attr("data-"+d.idField,"").attr("data-"+d.textField,"").val("").trigger("change"),g.val("").trigger("change"),m=!1,this._selected=!1,b!=c&&d.onSelect.call(this,{})),!n&&k&&setTimeout(function(){w(),r=1},200)}function y(){j||(k?(w(),e.focus()):z())}function z(){var b=e.val(),c={q:b,page:r,rows:d.rows};a.each(d.queryParams,function(a,b){c[a]=b}),setTimeout(function(){d.source(c,A)},100)}function A(b){var c="";if(i.html(""),s=Math.ceil(b.total/d.rows),Object.keys(d.addition).length>0){var f=d.addition;c+='<li class="'+d.item_cls+'" data-'+d.idField+'="'+f[d.idField]+'" data-'+d.textField+'="'+f[d.textField]+'"><a>'+f[d.textField]+"</a></li>"}a.each(b.rows,function(a,b){q[b[d.idField]]=b,c+='<li class="'+d.item_cls+'" data-'+d.idField+'="'+b[d.idField]+'" data-'+d.textField+'="'+b[d.textField]+'"><a>'+b[d.textField]+"</a></li>"}),Object.keys(b.rows).length>0?(i.append(c),i.find("li").first().addClass("active")):i.append('<span style="color:#999;">'+d.emptyMessage+"</span>"),v(),e.focus()}function B(){var a=i.find(".active");if(a.length){var b=a.position().top,c=b+a.height(),d=i.scrollTop(),e=i.height();c>e?i.scrollTop(d+c-e):b<0&&i.scrollTop(d+b)}}function C(a){if(k){switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault(),E(),B();break;case 40:a.preventDefault(),D(),B()}a.stopPropagation()}}function D(){var b=i.find(".active").removeClass("active"),c=b.next();c.length||(c=a(i.find("li")[0])),c.addClass("active")}function E(){var a=i.find(".active").removeClass("active"),b=a.prev();b.length||(b=i.find("li").last()),b.addClass("active")}function F(){var a=e.attr("value"),b=i.find(".active").data(d.idField),c=i.find(".active").data(d.textField);return a!==b&&(e.attr("value",b).attr("data-"+d.idField,b).attr("data-"+d.textField,c).val(c).trigger("change"),g.val(b).trigger("change"),0===b&&Object.keys(d.addition).length>0?d.onSelect.call(this,d.addition):d.onSelect.call(this,q[b])),m=!0,w()}function G(b){e.focus(),b.stopPropagation(),b.preventDefault();var c=(b.currentTarget.scrollTop+a(b.currentTarget).height())/b.currentTarget.scrollHeight*100;if(c>90){b.currentTarget;p||r<s&&(p=!0,r++,setTimeout(function(){var b=e.val(),c={q:b,page:r,rows:d.rows};a.each(d.queryParams,function(a,b){c[a]=b}),d.source(c,function(b){var c="";s=Math.ceil(b.total/d.rows),a.each(b.rows,function(a,b){q[b[d.idField]]=b,c+='<li class="'+d.item_cls+'" data-'+d.idField+'="'+b[d.idField]+'" data-'+d.textField+'="'+b[d.textField]+'"><a>'+b[d.textField]+"</a></li>"}),i.append(c),p=!1,e.focus()})},100))}}function H(a){switch(a.keyCode){case 40:k||y();break;case 39:case 38:case 37:case 36:case 35:case 16:case 17:case 18:break;case 9:case 13:if(!k)return;F();break;case 27:if(!k)return;w();break;default:z()}a.stopPropagation(),a.preventDefault()}function I(b){b?(e.on("focus",function(){l=!0}).on("blur",x).on("keypress",function(a){o||C(a)}).on("keydown",function(b){o=~a.inArray(b.keyCode,[40,38,9,13,27]),C(b)}).on("keyup",H).on("dblclick",y),i.on("click",function(a){e.focus(),a.stopPropagation(),a.preventDefault(),F()}).on("mouseenter","li",function(b){n=!0,i.find(".active").removeClass("active"),a(b.currentTarget).addClass("active")}).on("mouseleave",function(){n=!1}).scroll(G),h.on("click",y)):(e.off("blur focusout focus keydown keyup keypress dblclick"),i.off("click mouseenter mouseleave scroll"),h.off("click"))}var d=c,e=a(b),f=a(t()),g=f.find("input[type=hidden]"),h=f.find(".dropdown-toggle"),i=a(u()).appendTo("body"),j=!1,k=!1,l=!1,m=!1,n=!1,o={},p=!1,q={},r=d.page,s=1;this.o=d,this._o=function(b){a.extend(d,b)},this._selected=function(a){m=a},this._disabled=function(a){j=a},this._listen=function(a){I(a)},this.$element=e,this.$container=f,this.$target=g,this.$button=h,this.$menu=i,this.rowData=function(){return q},this.init()}b.prototype={constructor:b,version:function(){return console.log("1.1.3"),"1.1.3"},init:function(){if(!this.$element.data("init-combogrid")){this.$element.data("init-combogrid",!0),this.$element.before(this.$container),this.$target.before(this.$element),this.$target.attr("name",this.$element.attr("name")),this.$element.removeAttr("name"),this._listen(!0),void 0!==this.$element.attr("disabled")&&this.disable(!0);var a=this.$element.val();this.setValue(a)}},destroy:function(){console.log("debug: destroy"),this.$element.data("init-combogrid")&&(this.$element.data("init-combogrid",!1),this.$container.before(this.$element),this.$container.remove(),this._listen(!1))},disable:function(a){a?(this.$element.prop("disabled",!0),this.$button.attr("disabled",!0),this._listen(!1),this._disabled(!0)):(this.$element.prop("disabled",!1),this.$button.attr("disabled",!1),this._listen(!0),this._disabled(!1))},queryParams:function(a){this._o({queryParams:a})},getValue:function(a){var b;if(a=void 0===a?"id":a,void 0!==this.rowData()[this.$element.attr("value")])return this.$element.attr("value")?void 0!==(b=this.rowData()[this.$element.attr("value")][a])&&b:void 0},setValue:function(a){if(this.$element.data("init-combogrid")!==!1){var b=this.o,c=this.$element,d=this.$target,e=this._selected;return!a||a<0?(c.attr("value","").attr("data-"+b.idField,"").attr("data-"+b.textField,"").val("").trigger("change"),void d.val("").trigger("change")):void setTimeout(function(){b.source({id:a},function(a){if("undefined"!=typeof a.rows[0]){var f=a.rows[0][b.idField],g=a.rows[0][b.textField];c.attr("value",f).attr("data-"+b.idField,f).attr("data-"+b.textField,g).val(g).trigger("change"),d.val(f).trigger("change"),e(!0)}})},100)}}},a.fn.combogrid=function(c){if("string"==typeof c){var d=a(this),e=d.data("combogrid");return e?"getValue"==c?e[c].apply(e,Array.prototype.slice.call(arguments,1)):(e[c].apply(e,Array.prototype.slice.call(arguments,1)),this):this}return this.each(function(){var d=a(this),e=d.data("combogrid"),f="object"==typeof c?c:{};e?"object"==typeof c&&d.data("combogrid",new b(this,a.extend(e,f))):d.data("combogrid",new b(this,a.extend({},a.fn.combogrid.defaults,f)))})},a.fn.combogrid.defaults={source:function(a,b){},style:"bs3",menu_type:"normal",emptyMessage:"<center><b>No results were found</b></center>",colorBack:"#dd4b39",colorText:"#000000",page:1,rows:50,idField:"id",textField:"name",queryParams:{},item_cls:"",addition:{},onSelect:function(a){}}}(jQuery);